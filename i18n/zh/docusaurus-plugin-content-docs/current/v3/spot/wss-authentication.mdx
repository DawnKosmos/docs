---
title: 鑒權/認證
sidebar_label: 鑒權/認證
---


:::info
<b>請注意，以下接口僅適用於 <i>現貨</i></b>. 要監聽其他 websocket，請轉到:
<ul>
  <li><a href="https://bybit-exchange.github.io/docs/inverse/#t-websocketauthentication">反向永續/反向交割</a></li>
  <li><a href="https://bybit-exchange.github.io/docs/linear/#t-websocketauthentication">USDT (正向) 永續</a></li>
</ul>
:::

Websocket服務器地址:
<ul>
  <li><b>測試網</b>:</li>
  <ul>
    <li>公共Topics: <span id="testnet_address">wss://stream-testnet.bybit.com/spot/public/v3</span></li>
    <li>私有Topics: <span id="testnet_private_address">wss://stream-testnet.bybit.com/spot/private/v3</span></li>
  </ul>
  <li><b>主網</b>:</li>
  <ul>
    <li>公共Topics: <span id="mainnet_address">wss://stream.bybit.com/spot/public/v3</span></li>
    <li>私有Topics: <span id="mainnet_private_address">wss://stream.bybit.com/spot/private/v3</span></li>
  </ul>
</ul>

:::info
<b>公共類</b> topics不需要進行驗證. 以下部分只適用於 <b>私有</b> 類接口.
:::


<p>建立連接後發送auth請求驗證</p>
<p>注意：如果您正在使用 <a href="https://github.com/bybit-exchange/pybit">pybit</a> 或其他高級庫，你可以忽略這段代碼 - 因為身份驗證已經為您處理。</p>

```javascript
{
    "req_id": "10001", // optional
    "op": "auth",
    "args": [
        "api_key",
        1662350400000, //expires greater than currentTimeStamp
        "singature"
    ]
}
```

```python
# based on: https://github.com/bybit-exchange/pybit/blob/master/pybit/_http_manager.py

import hmac
import json
import time
import websocket

api_key = ""
api_secret = ""

# Generate expires.
expires = int((time.time() + 1) * 1000)

# Generate signature.
signature = str(hmac.new(
    bytes(api_secret, "utf-8"),
    bytes(f"GET/realtime{expires}", "utf-8"), digestmod="sha256"
).hexdigest())

ws = websocket.WebSocketApp(
    url=url,
    ...
)

# Authenticate with API.
ws.send(
    json.dumps({
        "op": "auth",
        "args": [api_key, expires, signature]
    })
)
```

:::info
點擊查看 <a href="https://github.com/bybit-exchange/api-usage-examples">示例加密算法</a>.
:::

:::caution
由於網絡的復雜性，您和Bybit的websocket鏈接隨時可能會斷開，為了保證您能及時收到websocket推送消息，強烈建議您按照以下建議處理網絡異常：
1. 通過發送心跳包保持連接
2. 一旦發現連接斷開，應該立刻重新建立連接。
:::


## 如何發送心跳包
如何發送心跳包

```javascript
// req_id is a customised id, which is optional
ws.send(JSON.stringify({"req_id": "100001", "op": "ping"}));
```

響應示例

```javascript
// with req_id
{"op":"pong","args":[1661741630642],"req_id":"100001","conn_id":"706b870c"}

// without req_id
{"op":"pong","args":[1661741654529],"conn_id":"706b870c"}
```


:::caution
由於網絡或者程序不穩定,我們強烈建議您使用 <b>ping</b> 心跳包來維持連接. 心跳包建議每<b>20</b>秒發送一次.
:::


## 頻率限製
<b>僅適用於私有頻道：</b>：每個api_key最多可以保持100個websocket私有連接，超過100個連接後的新連接會被服務器拒絕。單個IP同時最多50個websocket私有topic鏈接


## Websocket訂閱方式
### 直接訂閱

直接訂閱

```javascript
// Subscribing to the trade data for BTCUSDT
{
    "req_id": "10001", // optional
    "op": "subscribe",
    "args": [
        "trade.BTCUSDT"
    ]
}
```

支持多symbol，使用","隔開。

```javascript
// Example: Subscribing to the trade data for BTCUSDT and ETHUSDT
{
    "req_id": "10001", // optional
    "op": "subscribe",
    "args": [
        "trade.BTCUSDT",
        "trade.ETHUSDT"
    ]
}
```

<p>建立連接後, 可以通過發送JSON請求來訂閱topic. 請求格式如下:</p>


```javascript
ws.send('{"req_id": "10001", "op": "subscribe", "args": ["trade.BTCUSDT", "trade.ETHUSDT", "tickers.BTCUSDT", "bookticker.BTCUSDT"]}')
```

:::info
<code>args</code>裡的參數最多是<b>10</b>個，超過會報錯
:::

### Websocket取消訂閱方式

<p>訂閱成功後，可以通過發送JSON請求來取消訂閱. 請求格式如下:</p>

```javascript
ws.send('{"req_id": "10002", "op": "unsubscribe", "args": ["trade.BTCUSDT"]}');
```

```javascript
// Example: unsubscribing to the trade data for BTCUSDT and ETHUSDT
{
    "req_id": "10002", // optional
    "op": "unsubscribe",
    "args": [
        "trade.BTCUSDT",
        "trade.ETHUSDT"
    ]
}
```

```javascript
// unsubscribe response sample
{
    "op": "unsubscribe",
    "success": true,
    "req_id": "10002",
    "ret_msg": "unsubscribe",
    "conn_id": "46f097b7"
}
```

## 訂閱結果
訂閱推送

```javascript
{
    "op": "subscribe",
    "success": true,
    "req_id": "10001",
    "ret_msg": "subscribe",
    "conn_id": "46f097b7"
}
```

訂閱成功後會立即返回訂閱的消息結果，您可以根據返回結果判斷是否訂閱成功